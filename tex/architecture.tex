\section{Architecture}

In this section we present how smart environments are formalized, organized, and implemented.

% \subsection{Smart Environments as Cyber-Physical Systems}

% Smart environments can be formalized as Cyber-Physical Systems (CPSs), that are
% systems that integrate computations with physical processes~\cite{alur2015principles, lee2016introduction}. In our case, computations concern streams of data coming from
% sensors and actuators interacting with biological, hence physical, processes.
% In general, embedded computers monitor and control the physical processes, usually with feedback loops where physical processes affect computations and vice versa. The design of such systems, therefore, requires understanding the joint dynamics of computers, software, networks, as well as biological and physical processes~\cite{derler2012modeling}.

%\subsection{Discrete event model}
\subsection{Discrete Events}
%Smart Environments are Cyber-physical systems with a focus on biology.

We use \emph{discrete time} models to describe the cyber-physical systems we are creating.\cite{Lee1999} Discrete time is more suitable for our purposes since we deal with sensors and actuators that collect data and trigger actions at discrete time instances. For instance, a soil moisture sensor detects the soil humidity every ten minutes, or a water pump is either on or off at a specific time.

\subsection{\lq\lq Things\rq\rq}

We refer to the devices that compose our cyber-physical systems as \lq\lq\emph{things}\rq\rq.
Each thing is an event emitter producing timestamped events~\cite{Lee1999}.
Some examples of things in smart environments are, e.g.:
\begin{itemize}
    \item Organisms (perhaps at least a virtual objects representing organisms), e.g., plants, bacteria, fishes;
    \item Sensors, e.g., moisture sensors, thermometers, barometers;
    \item Actuators, e.g., water pumps, light switches, fan activators;
    \item A connected device, to be actuated both from the Edge (directly) and the Cloud (remotely);
    \item Feedback algorithms developed and modified over time, designed to sustain life
    \item Groups or collections of things
\end{itemize}

Note that there might be many things concurrently emitting events.

Another interesting aspect is that there can be hierarchies of things and importantly decision making within cyber-physical systems.

A sensor or actuator by itself is not useful unless it is viewed in context. By collecting together event data from sensors, actuators, and living things themselves we can create meaningful linked data. Importantly, event types are namespaced. For example, a temperature event can have its value be Celsius, Kelvin, or Fahrenheit. Luckily, linked data handles this all wonderfully. Technologies such as JSON-LD \cite{} can serve as namespaces for the events. Thus many types of things emitting many types of events can be integrated into our framework, in essence building complex interrelationships out simple components.

% \subsection{Environments}

% Environments can be modeled as a collection of parameters, surveyed with sensors. Each sensor typically only represents one discrete parameter. Importantly, complex interrelationships exist between parameters.

% % Nick: Below should be a figure or a flowchart, bullet point list looks odd

% An environment such as a grow room or greenhouse might contain the following:
% \begin{itemize}
%     \item Temperature sensor
%     \item Heater
%     \item Humidifier
%     \item Light
%     \item CO2 sensor
%     \item Plant A
%     \item Plant B
%     \item etc.
% \end{itemize}

% It is also possible to have multiple smart environments running simultaneously, and thus \emph{multiplex} scientific experiments.\cite{} Imagine 10 greenhouses, bioreactors, or opentrons robots... each running an iteration of the experiment.

\subsection{Reactive Modules}
%\subsection{Grow files}

The events generated by things can be 
listened by \emph{reactive module} that,
driven by the observed data, make 
decisions and take actions.
For instance, a reactive module might listen for temperature events coming from sensor arrays in a green house and control actuators such as heaters, fans, and vents.

\emph{Grow Files} is a way of encoding information about the organismâ€™s basic requirements and its desired phenotype. It can be serialized in JSON, JSON-LD, or XML. 
When we start the Grow, a stream of new events is created from all the things emitting events (there may or may not be listeners).

% the growfile creates a flow of events, similar to swarmlets ptolomy and node-red projects.

A Grow File is composed by three main components: targets, cycles, and phases.

\begin{itemize}
\item \emph{Targets} create listeners for events from sensors and emit alerts or correction events. For instance,
if an ideal threshold is specified for a target, a controller, such as PID~\cite{rivera1986internal}, emits correction events that drive the system towards the target.
Corrections can be used to control, for instance, heaters, dosing pumps, etc.;
%For control over the PID controller's parameters you can pass in options under a pid property.

\item \emph{Cycles} are functions that are called at specific times in succession (for example, during the course of a day).
Cycles are also a way of defining moving targets. For example, different target 
temperatures can fixed at daytime and nighttime;
%In the example above the 'day' event will be emitted after 7:00am. Various internet of things devices such as lights can listen for those events, and respond accordingly (such as turning the lights on).

\item \emph{Phases} are a way to create groups of cycles and/or targets.
For instance, a plants life cycle might be broke up into the seeding, vegetative, flowering, and harvest phases.
Each phase might have different environmental conditions with regards to lighting, pH, nutrients, temperature, etc.
Phases may have a length attribute which specifies how long they last. Additionally, some cases may require human intervention to transition the grow system towards the next phase (such as transplanting seedlings, or replacing the water in the reservoir). In other words, phases may automatically or manually transition into the next phase.

\end{itemize}

Such a data model constitutes the reactive module, a stream of events from an environment (or collection of environments) is parsed and new events are triggered given what's defined in a Grow file. For example, a low temperature might cause a heater to turn on, as well as fans to circulate the air in the chamber.